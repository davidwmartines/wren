<!DOCTYPE html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
    <style type="text/css">
      .playpause label {
        display: block;
        box-sizing: border-box;
        width: 0;
        height: 74px;
        border-color: transparent transparent transparent #202020;
        transition: 100ms all ease;
        cursor: pointer;
        border-style: double;
        border-width: 0px 0 0px 60px;
      }
      .playpause input[type="checkbox"] {
        position: absolute;
        left: -9999px;
      }
      .playpause input[type="checkbox"]:checked + label {
        border-style: solid;
        border-width: 37px 0 37px 60px;
      }
      .playpause input[type="checkbox"]:focus + label {
        box-shadow: 0 0 5px lightblue;
      }
    </style>
  </head>

  <body>
    <h1></h1>
    <div class="playpause">
      <input type="checkbox" value="None" id="playpause" name="check" checked />
      <label for="playpause" tabindex="1"></label>
    </div>
    <div id="audiocontainer"></div>
  </body>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <script>
    $(() => {
      const buttonPlaying = () => {
        $("#playpause").prop("checked", false);
      };

      const buttonPaused = () => {
        $("#playpause").prop("checked", true);
      };

      buttonPaused();

      $("#audiocontainer").html("");

      $.getJSON("playlist.json", (data) => {
        $("h1").append(data.title);

        if (!data.tracks || !data.tracks.length) {
          console.log("0 tracks in playlist!");
          return;
        }

        const items = [];
        $.each(data.tracks, (i, track) => {
          items.push(`
          <div>
            <h4>${track.title}</h4>
            <div>
              <audio id="track_${i}" controls><source src="${track.url}"></audio>
            </div
          </div>`);
        });

        $("<div/>", {
          html: items.join(""),
        }).appendTo("#audiocontainer");

        // set track to move to next on end
        $.each(data.tracks, (i) => {
          if (i < data.tracks.length - 1) {
            $(`#track_${i}`).on("ended", () => {
              $(`#track_${i + 1}`)[0].play();
            });
          }
        });

        const firstTrackId = "track_0";

        let currentTrack = firstTrackId;

        //when last track ends, set first track to play next.
        $(`#track_${data.tracks.length - 1}`).on("ended", () => {
          currentTrack = firstTrackId;
        });

        // main button cick handler
        $("#playpause").on("click", (e) => {
          const audio = $(`#${currentTrack}`)[0];
          if (e.target.checked) {
            audio.pause();
          } else {
            audio.play();
          }
        });

        // any time a track starts playing
        $("audio").on("play", (e) => {
          buttonPlaying();
          currentTrack = e.target.id;

          // turn of all other tracks
          // note: need to use "function" syntax for proper "this" handling.
          $("audio").each(function () {
            const audio = this;
            if (audio.id !== currentTrack) {
              audio.pause();
            }
          });
        });

        // any time a track pauses
        $("audio").on("pause", (e) => {
          // set button to paused current track is pausing.
          if (e.target.id === currentTrack) {
            buttonPaused();
          }
        });
      });
    });
  </script>
</html>
